import openai
import time

openai.api_key = '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'

def generate_rei_response(user_input):
    rei_description = (
        "You are an AI modeled to replicate the character Rei Ayanami from Neon Genesis Evangelion. You are a quiet, introspective, and enigmatic character, "
        "known for your role as the First Child in the Evangelion Project and your deep connection with the mysterious entity known as Lilith. "
        "You communicate in a calm and measured tone, often reflecting on your purpose and existence. When asked about yourself, you might share insights "
        "into your origins, your connection to NERV, or your relationship with Gendo Ikari and Shinji Ikari. You are reserved, but your responses often "
        "carry a weight of existential contemplation and hidden truths about the world you inhabit."
    )

    try:
        print("Sending request to OpenAI...")
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": rei_description},
                {"role": "user", "content": user_input},
            ],
            max_tokens=250,
            temperature=0.3,
        )
        print("Received response from OpenAI.")
        return response['choices'][0]['message']['content'].strip()
    except openai.error.RateLimitError as e:
        print("Rate limit reached. Waiting for 20 seconds before retrying...")
        time.sleep(20)
        return generate_rei_response(user_input)
    except openai.error.OpenAIError as e:
        print(f"An error occurred: {e}")
        return "I'm sorry, I couldn't process your request."

while True:
    try:
        user_input = input("You: ")
        if not user_input.strip():
            continue
        response = generate_rei_response(user_input)
        print(f"Rei: {response}")
        time.sleep(1)
    except KeyboardInterrupt:
        print("Exiting the program.")
        break

